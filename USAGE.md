# 販売計画システム - 使い方ガイド

## システムの特徴

**柔軟な階層構造**: CSVの固定カラム以外は自由に設定でき、商品データの階層を柔軟に定義できます。

## 基本的な流れ

```
BigQuery → CSV出力 → アップロード → 予算配分 → CSV出力
```

## 1. 構造の理解

```
カテゴリ（例: SLEEP寝具、アパレル）
  └── セッション（例: 2024年度予算、Q1計画）
        └── 作業エリア（CSV取り込み、予算配分）
```

- **カテゴリ**: 商品グループの分類
- **セッション**: 実際の予算配分作業を行う単位
- **作業はすべてセッション内で実施**

## 2. 基本操作

### Step 1: カテゴリを作成

1. ダッシュボードで「カテゴリ作成」
2. カテゴリ名を入力（例: SLEEP寝具）

### Step 2: セッションを作成

1. カテゴリを展開
2. 「セッション作成」をクリック
3. セッション名と総予算を入力

### Step 3: CSVをアップロード

1. セッションを開く
2. BigQueryで以下のようなSQLを実行してCSVを出力

```sql
SELECT
  category_2,           -- 階層1（固定カラム）
  raw_materials,        -- 階層2（自由設定可能）
  launch_year_season,   -- 階層3（自由設定可能）
  item_name,           -- 階層4（自由設定可能）
  size,                -- 階層5（自由設定可能）
  color,               -- 階層6（自由設定可能）
  sku_code,            -- SKUコード（必須）
  cost_price           -- 単価（必須）
FROM your_table
WHERE category_2 = 'SLEEP寝具'
```

3. 「CSV取り込み」ボタンでアップロード

**CSVフォーマット（必須カラム）**:
- `sku_code`: SKUコード（文字列）
- `unitprice`: 単価（数値）
- その他のカラム: 階層を構成（最大6階層まで対応）

### Step 4: 予算を配分

1. 階層ごとにパーセンテージを入力
2. 配分額は親階層の金額 × パーセンテージで自動計算
   - 例: 総予算100万円 → 階層1で25% → 階層2で50% = 100万 × 0.25 × 0.5 = 12.5万円
3. 「均等配分」ボタンで自動配分も可能
4. 「保存」ボタンで保存

### Step 5: 結果をエクスポート（将来実装予定）

現在はシステム内で配分結果を確認・編集できます。

## 3. 便利な機能

### SQLテンプレート表示

1. ダッシュボードでカテゴリを展開
2. 「SQL表示」ボタンでカテゴリ別のSQLテンプレートを表示
3. クリップボードにコピーしてBigQueryで実行

### 検索機能

- ダッシュボード: セッション名で検索
- セッション内: 階層内を検索

### 進捗確認

- 各階層の合計が100%になっているかをアイコンで表示
- ✓ = 100%完了
- ⚠ = 未完了

## 4. データの柔軟性（重要な特徴）

### 固定カラム（必須）
- `sku_code`: SKUコード
- `unitprice`: 単価

### 自由カラム（階層定義）
CSVに含まれる他のカラムは自由に設定可能。以下のような使い方ができます：

**例1: SLEEP寝具の場合**
```csv
category,raw_materials,launch_year,item_name,size,color,sku_code,unitprice
SLEEP寝具,コットン,2023,枕,標準,ホワイト,SKU001,5000
```
→ 6階層の構造が自動生成

**例2: アパレルの場合**
```csv
brand,season,type,sku_code,unitprice
ブランドA,春夏,Tシャツ,SKU002,3000
```
→ 3階層の構造が自動生成

**柔軟性のポイント**:
- カラム名は自由（日本語・英語どちらでも可）
- カラム数も自由（最大6階層まで）
- 商品カテゴリごとに異なる階層構造を定義可能

## 5. BigQueryとの連携

### データの流れ

```
BigQuery（データソース）
    ↓ CSV出力（手動）
アプリ（予算配分作業）
    ↓ CSV出力（将来実装予定）
分析・レポート
```

**注意**: 
- BigQueryとの直接連携機能はありません
- CSVを介した手動のデータ移行が基本
- INPUT/OUTPUT両方ともCSV形式

## 6. よくある質問

**Q: CSVを再アップロードできますか？**
A: 一度データをアップロードしたセッションには再アップロードできません。新しいセッションを作成してください。

**Q: 他のユーザーが作成したカテゴリ・セッションは見れますか？**
A: はい、全ユーザーのデータは共有されています。誰でも閲覧・編集可能です。

**Q: 階層はいくつまで作れますか？**
A: 最大6階層まで対応しています。

**Q: 配分の計算方法は？**
A: 階層的に計算されます。各階層の配分額 = 親階層の配分額 × パーセンテージ

---

## サポート

問題が発生した場合は、GitHubのIssueで報告してください。
